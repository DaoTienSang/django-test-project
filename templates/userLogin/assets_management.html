{% extends "userLogin/base_sidebar.html" %}

{% load static %}
{% load humanize %}

{% block title %}Qu·∫£n L√Ω T√†i S·∫£n - SmartTrade{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'userLogin/css/assets_management.css' %}">
{% endblock %}

{% block main-content %}
<main class="dashboard-content">
    <div class="dashboard-header">
        <h2>Qu·∫£n l√Ω T√†i s·∫£n</h2>
        <!-- <div class="date-filter">
            <span>Th·ªùi gian:</span>
            <select>
                <option>H√¥m nay</option>
                <option>Tu·∫ßn n√†y</option>
                <option>Th√°ng n√†y</option>
                <option>NƒÉm nay</option>
            </select>
        </div> -->
    </div>

    <!-- Th·∫ª th·ªëng k√™ -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon">üíº</div>
            <div class="stat-info">
                <h3>T·ªïng gi√° tr·ªã danh m·ª•c</h3>
                <p class="stat-value">{{ portfolio_value|intcomma }} VND</p>
                <!-- <p class="stat-change increase">% <span>t·ª´ th√°ng tr∆∞·ªõc</span></p> -->
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-info">
                <h3>L·ª£i nhu·∫≠n/L·ªó</h3>
                {% if total_profit_loss > 0 %}
                <p class="stat-value status-profit">+{{ total_profit_loss|intcomma }} VND</p>
                {% elif total_profit_loss < 0 %}
                <p class="stat-value status-loss">{{ total_profit_loss|intcomma }} VND</p>
                {% else %}
                <p class="stat-value status-breakeven">{{ total_profit_loss|intcomma }} VND</p>
                {% endif %}
                <!-- <p class="stat-change increase">+6.2% <span>t·ª´ th√°ng tr∆∞·ªõc</span></p> -->
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-info">
                <h3>S·ªë m√£ c·ªï phi·∫øu</h3>
                <p class="stat-value">{{ number_of_stock }}</p>
                <!-- <p class="stat-change increase">+2 <span>t·ª´ th√°ng tr∆∞·ªõc</span></p> -->
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìà</div>
            <div class="stat-info">
                <h3>C·ªï phi·∫øu tƒÉng/gi·∫£m</h3>
                <p class="stat-value">{{ number_profit_stock }}/{{ number_loss_stock }}</p>
                <p class="stat-change increase">+5% <span>hi·ªáu su·∫•t</span></p>
            </div>
        </div>
    </div>

    <!-- Ph√¢n b·ªï t√†i s·∫£n -->
    <!-- <div class="chart-container">
        <div class="chart-card">
            <div class="chart-header">
                <h2>Ph√¢n b·ªï danh m·ª•c ƒë·∫ßu t∆∞</h2>
                <div class="chart-actions">
                    <button class="btn-chart active">Ng√†nh</button>
                    <button class="btn-chart">C·ªï phi·∫øu</button>
                    <button class="btn-chart">R·ªßi ro</button>
                </div>
            </div>
            <div class="chart-body">
                <div class="chart-placeholder">
                    <div class="chart-line"></div>
                    <div class="chart-line"></div>
                    <div class="chart-line"></div>
                </div>
            </div>
        </div>
    </div> -->

    <!-- Danh s√°ch c·ªï phi·∫øu -->
    <div class="recent-transactions">
        <div class="section-header">
            <h2>Danh m·ª•c c·ªï phi·∫øu</h2>
            <a href="{% url 'userLogin:trading' %}" class="view-all">Mua/B√°n c·ªï phi·∫øu</a>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>M√£ CP</th>
                        <th>T√™n c√¥ng ty</th>
                        <!-- <th>Ng√†nh</th> -->
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>Gi√° mua</th>
                        <th>Gi√° hi·ªán t·∫°i</th>
                        <th>Gi√° tr·ªã</th>
                        <th>Thay ƒë·ªïi</th>
                        <th>L√£i/L·ªó</th>
                    </tr>
                </thead>
                <tbody>
                    {% for portfolio in portfolios %}
                    <tr>
                        <td>{{portfolio.stock_code}}</td>
                        <td>{{portfolio.company_name}}</td>
                        <td>{{portfolio.amount}}</td>
                        <td>{{portfolio.avg_buy_price|intcomma}}</td>
                        <td>{{portfolio.current_price|intcomma}}</td>
                        <td>{{portfolio.total_value|intcomma}}</td>
                        {% if portfolio.profit_loss > 0 %}
                        <td class="status-profit">+ {{ portfolio.price_change_percent }} %</td>
                        <td class="status-profit">+ {{ portfolio.profit_loss|intcomma }}</td>
                        {% elif portfolio.profit_loss < 0 %}
                        <td class="status-loss">{{ portfolio.price_change_percent }} %</td>
                        <td class="status-loss">{{ portfolio.profit_loss|intcomma }}</td>
                        {% else %}
                        <td class="status-breakeven">{{ portfolio.price_change_percent }} %</td>
                        <td class="status-breakeven">{{ portfolio.profit_loss|intcomma }}</td>
                        {% endif %}

                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="no-data">Ch∆∞a c√≥ t√†i s·∫£n n√†o</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- L·ªãch s·ª≠ giao d·ªãch -->
    <div class="recent-transactions">
        <div class="section-header">
            <h2>L·ªãch s·ª≠ giao d·ªãch g·∫ßn ƒë√¢y</h2>
            <a href="#" class="view-all">Xem t·∫•t c·∫£</a>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ng√†y</th>
                        <th>M√£ CP</th>
                        <th>Lo·∫°i</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>Gi√°</th>
                        <th>T·ªïng gi√° tr·ªã</th>
                        <th>Tr·∫°ng th√°i</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in recent_transactions %}
                    <tr>
                        <td>{{ transaction.date }}</td>
                        <td>{{ transaction.stock_code }}</td>
                        <td class="{% if transaction.is_sell %} type-sell {% else %} type-buy {% endif %}">{{ transaction.status_sell }}</td>
                        <td>{{ transaction.amount }}</td>
                        <td>{{ transaction.price|intcomma }} VND</td>
                        <td>{{ transaction.total_price|intcomma }} VND</td>
                        <td class="{% if transaction.is_successful %} status-completed {% else %} status-pending {% endif %}">{{ transaction.status_completed }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="no-data">Ch∆∞a c√≥ giao d·ªãch c·ªï phi·∫øu n√†o</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>
{% endblock %}